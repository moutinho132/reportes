<!DOCTYPE html>
<html>
    <head>
        <title>CMA/REPORT</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
        <script src="https://www.amcharts.com/lib/3/serial.js"></script>
        <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
        <script src="https://www.amcharts.com/lib/3/plugins/export/export.js"></script>
        <script src='pdfmake/pdfmake.min.js'></script>
        <script src='pdfmake/vfs_fonts.js'></script>
        <script src='pdfmake/script.js'></script> 
         <!-- Bootstrap -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <script src="js/bootstrap.min.js"></script>

        <link rel="stylesheet" type="text/css" href="css/estilos.css">
        <script src="js/filesaver.js" type="text/javascript"></script>
        <script src="js/html2canvas.js" type="text/javascript"></script>  
        
        <script src='pdfmake/pdfmake.min.js'></script>
        <script src='pdfmake/vfs_fonts.js'></script>
        <script src='pdfmake/script.js'></script>
    
        <style>
         .chartdiv {
          width: 800px;
          height: 220px;
        
        }
        </style>
        
    
          
    
        
        <script type="text/javascript">  
            
                
                
                //grafica
                
               
                //fin de la grafica de prueba
                
            AmCharts.makeChart( "chart1", {
                "type": "serial",
                "theme": "light",
                "autoMargins": false,
                "marginLeft": 50,
                "marginRight": 8,
                "marginTop": 30,
                "marginBottom": 26,
                "dataProvider": [ {
                  "country": "USA",
                  "visits": 2025
                }, {
                  "country": "China",
                  "visits": 1882
                }, {
                  "country": "Japan",
                  "visits": 1809
                }, {
                  "country": "Germany",
                  "visits": 1322
                }, {
                  "country": "UK",
                  "visits": 1122
                }, {
                  "country": "France",
                  "visits": 1114
                }, {
                  "country": "India",
                  "visits": 984
                }, {
                  "country": "Spain",
                  "visits": 711
                } ],
                "valueAxes": [ {
                  "gridColor": "#FFFFFF",
                  "gridAlpha": 0.2,
                  "dashLength": 0
                } ],
                "startDuration": 1,
                "graphs": [ {
                  "balloonText": "[[category]]: <b>[[value]]</b>",
                  "fillAlphas": 0.8,
                  "lineAlpha": 0.2,
                  "type": "column",
                  "valueField": "visits"
                } ],
                "chartCursor": {
                  "categoryBalloonEnabled": false,
                  "cursorAlpha": 0,
                  "zoomable": false
                },
                "categoryField": "country",
                "categoryAxis": {
                  "gridPosition": "start",
                  "gridAlpha": 0,
                  "tickPosition": "start",
                  "tickLength": 20
                },
                "export": {
                  "enabled": true,
                  "menu": []
                }

            } );
                AmCharts.makeChart( "chart2", {
                    "type": "serial",
                    "addClassNames": true,
                    "theme": "light",
                    "autoMargins": false,
                    "marginLeft": 50,
                    "marginRight": 8,
                    "marginTop": 30,
                    "marginBottom": 26,
                    "balloon": {
                      "adjustBorderColor": false,
                      "horizontalPadding": 10,
                      "verticalPadding": 8,
                      "color": "#ffffff"
                    },

                    "dataProvider": [ {
                      "year": 2009,
                      "income": 23.5,
                      "expenses": 21.1
                    }, {
                      "year": 2010,
                      "income": 26.2,
                      "expenses": 30.5
                    }, {
                      "year": 2011,
                      "income": 30.1,
                      "expenses": 34.9
                    }, {
                      "year": 2012,
                      "income": 29.5,
                      "expenses": 31.1
                    }, {
                      "year": 2013,
                      "income": 30.6,
                      "expenses": 28.2,
                    }, {
                      "year": 2014,
                      "income": 34.1,
                      "expenses": 32.9,
                      "dashLengthColumn": 5,
                      "alpha": 0.2,
                      "additional": "(projection)"
                    } ],
                    "valueAxes": [ {
                      "gridColor": "#FFFFFF",
                      "gridAlpha": 0.2,
                      "dashLength": 0
                    } ],
                    "startDuration": 1,
                    "graphs": [ {
                      "alphaField": "alpha",
                      "balloonText": "<span style='font-size:12px;'>[[title]] in [[category]]:<br><span style='font-size:20px;'>[[value]]</span> [[additional]]</span>",
                      "fillAlphas": 1,
                      "title": "Income",
                      "type": "column",
                      "valueField": "income",
                      "dashLengthField": "dashLengthColumn"
                    }, {
                      "id": "graph2",
                      "balloonText": "<span style='font-size:12px;'>[[title]] in [[category]]:<br><span style='font-size:20px;'>[[value]]</span> [[additional]]</span>",
                      "bullet": "round",
                      "lineThickness": 3,
                      "bulletSize": 7,
                      "bulletBorderAlpha": 1,
                      "bulletColor": "#FFFFFF",
                      "useLineColorForBulletBorder": true,
                      "bulletBorderThickness": 3,
                      "fillAlphas": 0,
                      "lineAlpha": 1,
                      "title": "Expenses",
                      "valueField": "expenses"
                    } ],
                    "categoryField": "year",
                    "categoryAxis": {
                      "gridPosition": "start",
                      "gridAlpha": 0,
                      "tickPosition": "start",
                      "tickLength": 20
                    },
                    "export": {
                      "enabled": true,
                      "menu": []
                    }
                  } );

            AmCharts.makeChart( "chart3", {
                    "type": "serial",
                    "theme": "light",
                    "autoMargins": false,
                    "marginLeft": 50,
                    "marginRight": 8,
                    "marginTop": 30,
                    "marginBottom": 26,
                    "dataProvider": [ {
                      "date": "2012-03-01",
                      "price": 20
                    }, {
                      "date": "2012-03-02",
                      "price": 75
                    }, {
                      "date": "2012-03-03",
                      "price": 15
                    }, {
                      "date": "2012-03-04",
                      "price": 75
                    }, {
                      "date": "2012-03-05",
                      "price": 158
                    }, {
                      "date": "2012-03-06",
                      "price": 57
                    }, {
                      "date": "2012-03-07",
                      "price": 107
                    }, {
                      "date": "2012-03-08",
                      "price": 89
                    }, {
                      "date": "2012-03-09",
                      "price": 75
                    }, {
                      "date": "2012-03-10",
                      "price": 132
                    }, {
                      "date": "2012-03-11",
                      "price": 158
                    }, {
                      "date": "2012-03-12",
                      "price": 56
                    }, {
                      "date": "2012-03-13",
                      "price": 169
                    }, {
                      "date": "2012-03-14",
                      "price": 24
                    }, {
                      "date": "2012-03-15",
                      "price": 147
                    } ],
                    "valueAxes": [ {
                      "logarithmic": true,
                      "dashLength": 1,
                      "guides": [ {
                        "dashLength": 6,
                        "inside": true,
                        "label": "average",
                        "lineAlpha": 1,
                        "value": 90.4
                      } ],
                      "position": "left"
                    } ],
                    "graphs": [ {
                      "bullet": "round",
                      "id": "g1",
                      "bulletBorderAlpha": 1,
                      "bulletColor": "#FFFFFF",
                      "bulletSize": 7,
                      "lineThickness": 2,
                      "title": "Price",
                      "type": "smoothedLine",
                      "useLineColorForBulletBorder": true,
                      "valueField": "price"
                    } ],
                    "chartCursor": {
                      "valueLineEnabled": true,
                      "valueLineBalloonEnabled": true,
                      "valueLineAlpha": 0.5,
                      "fullWidth": true,
                      "cursorAlpha": 0.05
                    },
                    "dataDateFormat": "YYYY-MM-DD",
                    "categoryField": "date",
                    "categoryAxis": {
                      "parseDates": true,
                      "gridPosition": "start",
                      "gridAlpha": 0,
                      "tickPosition": "start",
                      "tickLength": 20
                    },
                    "export": {
                      "enabled": true,
                      "menu": []
                    }
              } );
              
              
            /**
             * Función que activa la exportación de todos los gráficos a PDF
             */
                function exportCharts() {
                    var docDefinition = new Array(); 
                        docDefinition     = {  
                                // a string or { width: number, height: number }
                                pageSize: 'letter',
                                // by default we use portrait, you can change it to landscape if you wish
                                pageOrientation: 'portrait',
                                // [left, top, right, bottom] or [horizontal, vertical] or just a number for equal margins
                                pageMargins: [ 30, 60, 0, 45 ], 
                                "header": [],
                                "footer": [],
                                "content": [],			
                                styles:{
                                        graphTitles:{
                                                fontSize: 10,
                                                color: '#0088cc',
                                                marginLeft: 10					
                                        },
                                        textTiles:{
                                                fontSize: 10,					
                                                marginLeft: 10,
                                                bold: true,					
                                                marginBottom: 10
                                        },
                                        textParagraph:{
                                                fontSize: 8,					
                                                marginLeft: 10,
                                                marginRight: 10,
                                                alignment: 'justify',
                                                lineHeight: 1.2,
                                                marginBottom: 15				
                                        },
                                        ulList:{
                                                fontSize: 8,					
                                                marginLeft: 10,
                                                marginRight: 10,
                                                alignment: 'justify',
                                                lineHeight: 1.2,
                                                marginBottom: 15				
                                        },
                                        prueba: {
                                                borderTop: 3
                                        },
                                        titleTables:{
                                                fontSize: 14,
                                                color: "#2755FF",
                                                marginBottom: 10
                                            }
                                        }
                        };
// Header of the simple investment report
                    docDefinition.header.push({ 
                            canvas:[
                                    {
                                            type: 'rect',
                                            x: -1, 
                                            y: 0,
                                            w: 613, 
                                            h: 55,
                                            lineColor: '#091f3d',
                                            color: '#091f3d'
                                    }					
                                    ]				
                    });
		
                    docDefinition.header.push({
                            columns:[
                                    {
                                            marginTop: -47,
                                            alignment: 'left',
                                            color: '#FFFFFF',
                                            fontSize: 30,
                                            text: 'AVANTI WAY'
                                    }
                                    ]
                    });
		
                    docDefinition.header.push({
                            marginTop: -19, 
                            alignment: 'left',
                            color: '#046999',//091f3d
                            fontSize: 9,
                            text: 'Contenido RIGHT.'
                    });


                    docDefinition.content.push({
                            columns:[
                                    {
                                            marginTop: 40,
                                            alignment: 'center',
                                            color: '#091f3d',
                                            fontSize: 20,
                                            text: 'Contenido debajo del header'
                                    }
                            ]
                    });

                    /*docDefinition.content.push({
                            marginTop: 30,
                            marginLeft: 30,
                            color: '#091f3d',
                            text: 'Contenido probando'
                    });*/

                    /*docDefinition.content.push({
                            columns:[
                                    {
                                            width: '25%',
                                            marginTop: 7,
                                            canvas:[
                                                    {
                                                            type: 'ellipse',  
                                                            x: 5, y: 10, // position
                                                            color: '#ffffff', //background
                                                            lineColor: '#f79727', // border color							
                                                            lineWidth: 2, // border width							
                                                            r1: 7, r2: 7 // width, height							
                                                    },
                                                    {
                                                            type: 'rect',
                                                            x: 11, 
                                                            y: 10,
                                                            w: 530, 
                                                            h: 1,
                                                            lineColor: '#f79727',
                                                            color: '#f79727',
                                                    },
                                                    {
                                                            type: 'ellipse',  
                                                            x: 541, y: 10, // position
                                                            color: '#ffffff', //background
                                                            lineColor: '#f79727', // border color							
                                                            lineWidth: 2, // border width							
                                                            r1: 7, r2: 7 // width, height							
                                                    }
                                            ]
                                    }
                            ]
                    });*/
		
			
                    /*docDefinition.content.push({ 	
                            marginTop: 15,				
                            columns:[
                                    {
                                            width: '35%',
                                            alignment: 'center',					
                                            //marginTop: 8,
                                            color: '#09203D',
                                            fontSize: '16',
                                            text: 'Contenido probando 2'

                                    },
                                    {					 
                                            width: '35%',
                                            alignment: 'center',					
                                            //marginTop: 8,
                                            color: '#09203D',
                                            fontSize: '16',
                                            text: 'Contenido header'
                                    },
                                    {					 
                                            width: '30%',
                                            alignment: 'center',					
                                            //marginTop: 8,
                                            color: '#09203D',
                                            fontSize: '16',
                                            text: 'Contenido probando 3'
                                    }
                            ]
                    });*/
                        var valor;
                    
                                    html2canvas(document.getElementById('htmlContent'), {
                                        onrendered: function (canvas) {
                                             valor = canvas.toDataURL();
                                           /* var docDefinition = {
                                                content: [{
                                                    image: valor,
                                                    width: 500

                                                }]

                                            };*/
                                              console.log('Valor De la funcion');
                                              console.log(valor);
                                                 //pdfMake.createPdf(docDefinition).download("Score_Details.pdf");
                                      
                                      
                                        
                                 
                                
                    docDefinition.content.push({ 	
                            marginTop: 30,				
                            columns:[
                                   /* {
                                            width: '35%',
                                            marginLeft: 27,					
                                            marginTop: -10,
                                            color: '#2FB4F2',
                                            fontSize: '22',
                                            text: 'Contenido'

                                    },
                                    {					 
                                            width: '35%',
                                            marginLeft: 38,					
                                            marginTop: -20,
                                            color: '#2FB4F2',
                                            fontSize: '22',
                                            text: 'Contenido'
                                    },*/
                                    
                                    {		
                                            
                                            marginLeft: -20,					
                                            marginTop: -20,
                                            color: '#2FB4F2',
                                            fontSize: '140',			 
                                            width: 600,
                                            
                                            image: valor
                                            
                                    }
                            ]
                    });
                           }
                                    });
		// Header of the simple investment report
                        docDefinition.header.push({ 
                                canvas:[
                                        {
                                                type: 'rect',
                                                x: -1, 
                                                y: 0,
                                                w: 613, 
                                                h: 55,
                                                lineColor: '#091f3d',
                                                color: '#091f3d'
                                        }					
                                ]				
                        });
                    
                    // Iterar a través de todos los gráficos y preparar sus imágenes para la exportación
                    var images = [];
                   
                   var dd;
                  
                    
                    
                    var pending = AmCharts.charts.length;
                    //console.log(pending);
                    //procedimiento para imprimir elementos div de la Graficas
                    
                    if(pending !=0){
                        console.log(pending);
                    }
                        for ( var i = 0; i < AmCharts.charts.length; i++ ) {
                            var chart = AmCharts.charts[ i ];
                                    chart.export.capture( {}, function() {
                                        this.toJPG( {}, function( data ) {
                                            
                                            docDefinition.content.push( {
                                                  marginTop: 70, 
                                                    columns:[
                                                        {
                                                            "image": data,
                                                             "fit": [ 400, 400] ,
                                                            fontSize: '80',
                                                            color: '#2FB4F2',
                                                            width: '30%',
                                                            marginLeft: 27,					
                                                            marginTop: -50

                                                        }
                                                        
                                                        /*{					 
                                                                width: '30%',
                                                                marginLeft: 38,					
                                                                marginTop: 10,
                                                                color: '#09203D',
                                                                fontSize: '9',
                                                                text: 'PRUEBA 1'
                                                        },
                                                        /*{					 
                                                                width: '30%',
                                                                marginLeft: 38,					
                                                                marginTop: 10,
                                                                color: '#09203D',
                                                                fontSize: '9',
                                                                text: 'PRUEBA 2'
                                                        }*/
                                                    ]
                                                } );
                                            
                                            
                                   
                                    pending--;
                                        if ( pending === 0 ) {
                                            // all done - construct PDF
                                            chart.export.toPDF( {
                                              content: images

                                            }, function( data ) {

                                                //this.download( data, "application/pdf", "reportePDF.pdf" );
                               
                                               /* docDefinition.content.push({ 	

                                                                width: '35%',
                                                                marginLeft: 270,					
                                                                marginTop: -130,
                                                                color: '#2FB4F2',
                                                                fontSize: '22',
                                                                text: '$ 135,000'

                                        });*/

                                       /* docDefinition.content.push({ 	
                                           
                                                                width: '35%',
                                                                marginLeft: 445,
                                                                //marginRight: 50,						
                                                                marginTop: -27,
                                                                color: '#2FB4F2',
                                                                fontSize: '22',
                                                                text: '$ 3,000',
                                                        
                                        });*/

                                        /*docDefinition.content.push({ 	

                                                                width: '35%',
                                                                marginLeft: 270,					
                                                                marginTop: 4,
                                                                color: '#09203D',
                                                                fontSize: '16',
                                                                text: '30-Yr'

                                        });*/   
                                            //$(document).ready(function() {
                                            // htmlToPdfMake('#htmlContent');
                                            
                                          
                                            function htmlToPdfMake(elementID){
                                
                                                var fullText = "";
                                                    //var x = document.getElementById('htmlContent').elements;
                                                    //var x = $("a").parent(elementID)
                                                    var x = $(elementID).children();
                                                    $.each(x, function(index, value) {
                                                       //console.log(value);
                                                        fullText+=$(this).context.innerText + ",";
                                                        console.log($(this).context.innerText);
                                                });

                                                 dd = {
                                                    content: [
                                                            fullText
                                                    ]
                                                };
                                                    //pdfMake.createPdf(dd).download('optionalName.pdf');

                                                    console.log(dd.content);
                                                    //  console.log(x);

                                                    //var html = $(elementID).html();

                                                    //$("#result").text(html);

                                                    //var p = $(elementID).html();

                                                    //$("#resultPDF").text(p);
                                                    return dd.content;
                                             }
                               
                                        /*docDefinition.content.push({ 	

                                                                width: '35%',
                                                                marginLeft: 310,					
                                                                marginTop: -14,
                                                                color: '#09203D',
                                                                fontSize: '12',
                                                                text: htmlToPdfMake('#htmlContent')	
                                        });*/
                                        //Aqui tambien obtenemos parrafo del div
                                        docDefinition.content.push({ 	

                                                                width: '35%',
                                                                marginLeft: 270,					
                                                                marginTop: 2,
                                                                color: '#09203D',
                                                                fontSize: '20',
                                                                text: 'Contenido'	
                                        });

                                     

                                        // Footer of the simple investment report
                                        docDefinition.footer.push({ 
                                                canvas:[
                                                        {
                                                                type: 'rect',
                                                                x: -1, 
                                                                y: 0,
                                                                w: 613, 
                                                                h: 45,
                                                                lineColor: '#091f3d',
                                                                color: '#091f3d'
                                                        }					
                                                ]				
                                        });

                                        docDefinition.footer.push({
                                                marginTop: -30,
                                                marginLeft: 190,
                                                color: '#fff',
                                                fontSize: 16,
                                                text: 'avantiway.com     305.229.1146'
                                        });

                                        docDefinition.footer.push({
                                                marginTop: -18,
                                                marginLeft: 304,
                                                color: '#f8940d',
                                                fontSize: 16,
                                                text: '|'
                                        });

                                        docDefinition.footer.push({
                                                marginTop: -48, 
                                                alignment: 'center',
                                                color: '#091f3d',
                                                fontSize: 9,
                                                text: 'Contenido'
                                        }); 
                                        //Generacion de Reporte con Grafica
                                        
                                        
                                            /*docDefinition.content.push({
                                                marginTop: 100,
                                                marginLeft: 30,
                                                color: '#091f3d',
                                                //bold: true,
                                               " text": 'Contenido nose'
                                        });*/
                                      
                                  
                                       // cargarContenido();
                                        pdfMake.createPdf(docDefinition).open();
                                        console.log('***************************************');
                                            } );
                                        }
                                } );
                            } );
                        }
                  }
                  
               
                //Esta Funcion convierte una Etiqueta DIV en imagen png. La cual se usara para incrustrar en en el pdf
                //Autor Fernando Moutinho
              function capturarImagenDiv(elemento1,elemento2){ 
                       var img;
                                    $(function() { 
                                        $("#crearimagen").click(function() { 
                                            html2canvas($("#contenido2"), {
                                                onrendered: function(canvas) {
                                                    theCanvas = canvas;
                                                    document.body.appendChild(canvas);

                                                    
                                               
                                                        canvas.toBlob(function(blob) {

                                                      var valor=saveAs(blob, "ImagenDiv.png"); 
                                                       
                                                     console.log(valor);
                                                        
                                                    });

                                                }
                                            });
                                        });
                                    });
                }
                
                
                
                
                //funcion para cargar contenido html
                            function cargarContenido(){             
                                html2canvas(document.getElementById('Contenido1'), {
                                    onrendered: function (canvas) {
                                        var valor = canvas.toDataURL();
                                        var docDefinition = {
                                            content: [{
                                                image: valor,
                                                width: 500
                                                
                                            }]
                                      
                                        };
                                          console.log('Valor De la funcion');
                                          console.log(valor);
                                        pdfMake.createPdf(docDefinition).download("Score_Details.pdf");
                                      
                                      
                                        
                                    }
                                    });
                                   
                            }
                            
                            
                            
                                //$(document).ready(function() {
                                  //  htmlToPdfMake('#htmlContent');
                               // });

                                
        </script>
        
    </head>
    <body >
          
        <div class="container">
            <div class="row" id="contenido">
                
                <span style="font-size:11px;">Puedes hacer click con el botón derecho del Mouse para Guardar la imagen.</span>
                <input type="button" value="Exportar Reportes de Graficas a PDF" onclick="exportCharts();" />
                <div id="chart1" class="chartdiv" style="alignment-adjust: central"></div>
                <div id="chart2" class="chartdiv"></div>
                <div id="chart3" class="chartdiv"></div>
                <div id='prueba'>Div Completo</div>
                 <div class="row" id="contenido2">
                        <footer>
                            <div class="container text-center">
                              <p class="text-muted credit">
                                Desarrollado por Fernando moutinho
                              </p>
                            </div>        
                          </footer>





                      <div class="row">
                              <div class="col-md-12" id="img-out" align="center">
                                <h5 style="font-weight:bold; color:purple;">Cargando el Cotendito HTMl en el PDF</h5>
                                <span style="font-size:11px;">Puedes hacer click con el botón derecho del Mouse para Guardar la imagen.</span>        
                              </div>
                      </div>     
                 </div> 
            </div>
            
        
       
          
                        
                        <div id="htmlContent">
                                <p>Este es el contenido que esta dentro de un div</p>
                                <p>Desarrollado por Fernando Moutinho Solo contenido de texto..</p>
                            <div class="container-fluid">
                                    <h1>Hello World!</h1>
                                    <p>Resize the browser window to see the effect.</p>
                                    <div class="row">
                                      <div class="col-sm-4" style="background-color:lavender;">.col-sm-4</div>
                                      <div class="col-sm-4" style="background-color:lavenderblush;">.col-sm-4</div>
                                      <div class="col-sm-4" style="background-color:lavender;">.col-sm-4</div>
                                    </div>
                                  </div>
                            </div>

                    
                        <div id="result">
                        
                            <button id="crearimagen" class="form-control" onclick="cargarContenido()"/>Crear Imagen del Div</button>
                        </div>
	
    </body>
</html>
